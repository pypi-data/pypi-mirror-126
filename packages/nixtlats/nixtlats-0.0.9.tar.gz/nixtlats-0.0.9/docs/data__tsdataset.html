---

title: TimeSeries Dataset


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/data__tsdataset.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/data__tsdataset.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Base-Dataset">Base Dataset<a class="anchor-link" href="#Base-Dataset"> </a></h2><blockquote><p>Transforms pandas DataFrame into a TimeSeriesDataset for the Dataloder.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseDataset" class="doc_header"><code>class</code> <code>BaseDataset</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L18" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseDataset</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwds</code></strong>) :: <code>Dataset</code></p>
</blockquote>
<p>A class used to store Time Series data.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseDataset.__getitem__" class="doc_header"><code>BaseDataset.__getitem__</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L278" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseDataset.__getitem__</code>(<strong><code>idx</code></strong>:<code>Union</code>[<code>slice</code>, <code>int</code>])</p>
</blockquote>
<p>Creates batch based on index.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>index: np.ndarray
    Indexes of time series to consider.</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>Dictionary with keys:</p>

<pre><code>- S
- Y
- X
- available_mask
- sample_mask
- idxs</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseDataset.__len__" class="doc_header"><code>BaseDataset.__len__</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L302" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseDataset.__len__</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseDataset.get_n_variables" class="doc_header"><code>BaseDataset.get_n_variables</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L307" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseDataset.get_n_variables</code>()</p>
</blockquote>
<p>Gets number of exogenous and static variables.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseDataset.get_n_series" class="doc_header"><code>BaseDataset.get_n_series</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L312" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseDataset.get_n_series</code>()</p>
</blockquote>
<p>Gets number of time series.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseDataset.get_max_len" class="doc_header"><code>BaseDataset.get_max_len</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L317" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseDataset.get_max_len</code>()</p>
</blockquote>
<p>Gets max len of time series.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseDataset.get_n_channels" class="doc_header"><code>BaseDataset.get_n_channels</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L322" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseDataset.get_n_channels</code>()</p>
</blockquote>
<p>Gets number of channels considered.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BaseDataset.get_frequency" class="doc_header"><code>BaseDataset.get_frequency</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L327" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BaseDataset.get_frequency</code>()</p>
</blockquote>
<p>Gets infered frequency.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_default_mask_df" class="doc_header"><code>get_default_mask_df</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L333" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_default_mask_df</code>(<strong><code>Y_df</code></strong>:<code>DataFrame</code>, <strong><code>ds_in_test</code></strong>:<code>int</code>, <strong><code>is_test</code></strong>:<code>bool</code>)</p>
</blockquote>
<p>Constructs default mask df.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>Y_df: pd.DataFrame
    Target time series with columns ['unique_id', 'ds', 'y'].
ds_in_test: int
    Numer of datestamps to use as outsample.
is_test: bool
    Wheter target time series belongs to test set.</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>Mask DataFrame with columns
['unique_id', 'ds', 'available_mask', 'sample_mask'].</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TimeSeriesDataset" class="doc_header"><code>class</code> <code>TimeSeriesDataset</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L372" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TimeSeriesDataset</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwds</code></strong>) :: <a href="/nixtlats/data__tsdataset.html#BaseDataset"><code>BaseDataset</code></a></p>
</blockquote>
<p>A class used to store Time Series data.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="TimeSeriesDataset.__getitem__" class="doc_header"><code>TimeSeriesDataset.__getitem__</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L426" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>TimeSeriesDataset.__getitem__</code>(<strong><code>idx</code></strong>:<code>Union</code>[<code>slice</code>, <code>int</code>])</p>
</blockquote>
<p>Creates batch based on index.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>index: np.ndarray
    Indexes of time series to consider.</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>Dictionary with keys:</p>

<pre><code>- S
- Y
- X
- available_mask
- sample_mask
- idxs</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Windows-Dataset">Windows Dataset<a class="anchor-link" href="#Windows-Dataset"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="WindowsDataset" class="doc_header"><code>class</code> <code>WindowsDataset</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L471" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>WindowsDataset</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwds</code></strong>) :: <a href="/nixtlats/data__tsdataset.html#BaseDataset"><code>BaseDataset</code></a></p>
</blockquote>
<p>A class used to store Time Series data.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WindowsDataset.__getitem__" class="doc_header"><code>WindowsDataset.__getitem__</code><a href="https://github.com/Nixtla/nixtlats/tree/master/nixtlats/data/tsdataset.py#L639" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WindowsDataset.__getitem__</code>(<strong><code>idx</code></strong>:<code>Union</code>[<code>slice</code>, <code>int</code>])</p>
</blockquote>
<p>Creates batch based on index.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>index: np.ndarray
    Indexes of time series to consider.</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>Dictionary with keys:</p>

<pre><code>- S
- Y
- X
- available_mask
- sample_mask
- idxs</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Default-mask-example-and-tests">Default mask example and tests<a class="anchor-link" href="#Default-mask-example-and-tests"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_default_mask</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="p">):</span>
    <span class="n">mask_df</span> <span class="o">=</span> <span class="n">get_default_mask_df</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Y_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">mask_df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;Unmatching index bewteen Y_df and mask_df&#39;</span>
    
    <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">mask_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">):</span>
        <span class="n">len_ts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">expected_sample_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">len_ts</span><span class="p">)</span>
        <span class="n">expected_sample_mask</span><span class="p">[</span><span class="o">-</span><span class="n">ds_in_test</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">is_test</span><span class="p">:</span> 
            <span class="n">expected_sample_mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">expected_sample_mask</span>
        <span class="n">expected_available_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">len_ts</span><span class="p">)</span>
        
        <span class="n">sample_mask</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sample_mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">available_mask</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;available_mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">sample_mask</span><span class="p">,</span> <span class="n">expected_sample_mask</span><span class="p">),</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Error for sample mask for time series </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
        
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">available_mask</span><span class="p">,</span> <span class="n">expected_available_mask</span><span class="p">),</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Error for available mask for time series </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-for-synthtetic-time-series-data">Test for synthtetic time series data<a class="anchor-link" href="#Test-for-synthtetic-time-series-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nixtlats.data.utils</span> <span class="kn">import</span> <span class="n">create_synthetic_tsdata</span>

<span class="n">Y_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">S_df</span> <span class="o">=</span> <span class="n">create_synthetic_tsdata</span><span class="p">()</span>
<span class="n">ds_in_test</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">is_test</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">test_default_mask</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="p">)</span>
<span class="n">test_default_mask</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example-and-test-for-datasets-with-two-time-series">Example and test for datasets with two time series<a class="anchor-link" href="#Example-and-test-for-datasets-with-two-time-series"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">nixtlats.data.datasets.epf</span> <span class="kn">import</span> <span class="n">EPF</span><span class="p">,</span> <span class="n">EPFInfo</span>

<span class="n">Y_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">S_df</span> <span class="o">=</span> <span class="n">EPF</span><span class="o">.</span><span class="n">load_groups</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="s1">&#39;PJM&#39;</span><span class="p">])</span>
<span class="n">test_default_mask</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="mi">728</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">mask_df</span> <span class="o">=</span> <span class="n">get_default_mask_df</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="mi">728</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mask_df</span><span class="o">.</span><span class="n">sample_mask</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&lt;matplotlib.lines.Line2D at 0x7fb7fd6d1ad0&gt;]</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXQAAAD4CAYAAAD8Zh1EAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjQuMSwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy/Z1A+gAAAACXBIWXMAAAsTAAALEwEAmpwYAAARsElEQVR4nO3de4xcB3XH8e+pTaA8ShJskPEDO62B+o8khE1IeJQUSrATVKsSUhNKAymRG5VUtJVaEqG2qvinlBYhSsBY1AX6wBSIwE1N3YrnHwjIRoUQJzgsSYmXANmUKNBENHFy+sfckMlkd+favuOZOf5+pNXOfczuOb7jn2bvnJkbmYkkafr93LgLkCR1w0CXpCIMdEkqwkCXpCIMdEkqYuW4fvGqVaty48aN4/r1kjSVbrjhhrszc/Vi28YW6Bs3bmR2dnZcv16SplJEfHepbZ5ykaQiDHRJKsJAl6QiDHRJKsJAl6QihgZ6ROyOiLsi4qYltkdEvCci5iLixog4q/syJUnDtHmG/iFg6zLbtwGbm68dwPuPvSxJ0pEaOoeemV+KiI3L7LId+Ej2Pof3KxFxckSsyczvd1Vkv4M/+An/duOdo/jROkavOePZPPdZTxt3Gcfs47OHOPSj+8ddhgace9ozePEvrRp3GROtizcWrQUO9S3PN+seF+gRsYPes3g2bNhwVL9s7q7/5W8/P3dU99XoZMIPf/x/vOO1p4+7lGPy0wcf4o8/cSMAEWMuRj+TCV+4dYG9V7503KVMtC4CfbGH/aJXzcjMXcAugJmZmaO6ssZFp6/hotMvOpq7aoRe8pef46ECF0t5uOnh6m3P53df/otjrkaPuPzD1/P9e3867jImXhdTLvPA+r7ldYDnRCTpOOsi0PcClzbTLucC947q/LkkaWlDT7lExEeB84FVETEP/DnwBIDM3AnsAy4E5oD7gctGVawkaWltplwuGbI9gTd3VpEk6aj4TlFJKsJAV2cKDLmU6KEqj81wBrq0CGfQJ40HpA0DXZKKMNAlqQgDXZKKMNAlqQgDXZ3JxT/CZ6pMfwd1eWyGM9AlqQgDXZ2oNuYXjslNlGqPr1Ex0CWpCANdkoow0CWpCANdkoow0NWdAnNl6SdATSyPzXAGuiQVYaCrE9XGyqr1M+08HO0Y6JJUhIEuSUUY6JJUhIEuSUUY6OpMhaGyCj3oxGWgS1IRBro64acTapQcI23HQJekIgx0SSrCQJekIgx0SSrCQFdnKnwaXoEWyvLYDGegqxPVphCiWkNTzimqdgx0SSqiVaBHxNaIOBgRcxFx1SLbnx4R/xoR34iIAxFxWfelSpKWMzTQI2IFcA2wDdgCXBIRWwZ2ezNwc2aeAZwP/E1EnNRxrZKkZbR5hn4OMJeZt2XmA8AeYPvAPgk8LXonHp8K/Ag43GmlkqRltQn0tcChvuX5Zl2/9wK/DNwJfBN4S2Y+PPiDImJHRMxGxOzCwsJRlqxJVWIIoUQTNaUHZ6g2gb7Yy8uD/7KvBr4OPBs4E3hvRPzC4+6UuSszZzJzZvXq1UdYqiRpOW0CfR5Y37e8jt4z8X6XAddmzxxwO/D8bkrUNKg2VFatn2nnFGk7bQL9emBzRGxqXui8GNg7sM8dwCsBIuJZwPOA27osVJK0vJXDdsjMwxFxJbAfWAHszswDEXFFs30n8HbgQxHxTXpPbt6amXePsG5J0oChgQ6QmfuAfQPrdvbdvhO4oNvSJElHwneKSlIRBro6U+HDkxyNm1wVHl+jZqBLUhEGujpR7dMJi7Uz9Twe7RjoklSEgS5JRRjoklSEgS5JRRjo6kyFqTJH4yaXh2Y4A12SijDQ1YlqU2XV+pl2XiS6HQNdkoow0CWpCANdkoow0CWpCANdnckCM3/T30FdFR5fo2agS1IRBrq6UWyqrNqnR049D0crBrokFWGgS1IRBrokFWGgS1IRBro6U2GozNG4yeWRGc5AVyeqDSE45DJZPBztGOiSVISBLklFGOiSVISBLklFGOjqToExhAIt1OXBGcpAl6QiWgV6RGyNiIMRMRcRVy2xz/kR8fWIOBARX+y2TE26ah9mVaub6Vft8TUqK4ftEBErgGuAVwHzwPURsTczb+7b52TgfcDWzLwjIp45onolSUto8wz9HGAuM2/LzAeAPcD2gX1eB1ybmXcAZOZd3ZYpSRqmTaCvBQ71Lc836/o9FzglIr4QETdExKWL/aCI2BERsxExu7CwcHQVS5IW1SbQFzt5Nfh680rghcBFwKuBP42I5z7uTpm7MnMmM2dWr159xMVKkpY29Bw6vWfk6/uW1wF3LrLP3Zl5H3BfRHwJOAO4tZMqNRWywFyZn801uTw0w7V5hn49sDkiNkXEScDFwN6BfT4NvCwiVkbEk4EXAbd0W6okaTlDn6Fn5uGIuBLYD6wAdmfmgYi4otm+MzNviYh/B24EHgY+mJk3jbJwTZZyQ2WOyU0Uj0Y7bU65kJn7gH0D63YOLL8TeGd3pUmSjoTvFJWkIgx0SSrCQJekIgx0dabCyF+F0cuqvN7rcAa6JBVhoKsT1ab8irUz9ao9vkbFQJekIgx0SSrCQJekIgx0SSrCQFdnSkyVVeihKA/NcAa6JBVhoKsTUWzQzzG5yeLhaMdAl6QiDHRJKsJAl6QiDHRJKsJAV2cqfFLh9HdQV4mx2BEz0NWJalMh1aZ2pl1Ue4CNiIEuSUUY6JJUhIEuSUUY6JJUhIGuzlSYQqjQQ1UVpqhGzUCXpCIMdGkRTslNFg9HOwa6JBVhoEtSEQa6JBVhoEtSEQa6OlNhqMzRuMnlSOlwrQI9IrZGxMGImIuIq5bZ7+yIeCgiXttdiZKkNoYGekSsAK4BtgFbgEsiYssS+70D2N91kZp81T4Nr1Y3BXhAWmnzDP0cYC4zb8vMB4A9wPZF9vt94JPAXR3WJ0lqqU2grwUO9S3PN+t+JiLWAr8B7FzuB0XEjoiYjYjZhYWFI61VkrSMNoG+2B87gy9PvBt4a2Y+tNwPysxdmTmTmTOrV69uWaIkqY2VLfaZB9b3La8D7hzYZwbY05xHXQVcGBGHM/NTXRQpSRquTaBfD2yOiE3A94CLgdf175CZmx65HREfAq4zzE88FcbKKvRQlcdmuKGBnpmHI+JKetMrK4DdmXkgIq5oti973lySdHy0eYZOZu4D9g2sWzTIM/ONx16Wpk21qbJiU5hTz4t2t+M7RSWpCANdkoow0CWpCANdkoow0NWh6Z8rm/4OdCIz0CWpCANdnag25ueY3GSp9vgaFQNdkoow0CWpCANdkoow0CWpCANdnanwaXhZoYmiPDbDGejqRLkphGr9TDkPRzsGuiQVYaBLUhEGuiQVYaBLUhEGujpTYQbBQYrJ5aEZzkCXpCIMdHWi2odZ1epm+pUbix0RA12SijDQJakIA12SijDQJakIA12d8cOTNEo+vIYz0CWpCANdnag2VhbVGppy1cZiR8VAl6QiDHRJKsJAl6QiWgV6RGyNiIMRMRcRVy2y/bci4sbm68sRcUb3pUqSljM00CNiBXANsA3YAlwSEVsGdrsdeHlmng68HdjVdaGafBWmyhyNm1xZ4hE2Wm2eoZ8DzGXmbZn5ALAH2N6/Q2Z+OTPvaRa/AqzrtkxJ0jBtAn0tcKhveb5Zt5Q3AZ9ZbENE7IiI2YiYXVhYaF+lJl61obJq/Uw7p0jbaRPoi/1TLvq3T0T8Kr1Af+ti2zNzV2bOZObM6tWr21cpSRpqZYt95oH1fcvrgDsHd4qI04EPAtsy83+6KU+S1FabZ+jXA5sjYlNEnARcDOzt3yEiNgDXAr+dmbd2X6YkaZihz9Az83BEXAnsB1YAuzPzQERc0WzfCfwZ8Azgfc1bpg9n5szoypYkDWpzyoXM3AfsG1i3s+/25cDl3ZamaVNh5M/RuMlV4fE1ar5TVN0oNoZQrJ2p5/Fox0CXpCIMdEkqwkCXpCIMdEkqwkCXpCIMdHWmwlSZo3GTy0MznIGuTlSbKnNMbtJ4QNow0CWpCANdkoow0CWpCANdkoow0NWZLDAiMv0d1FXg4TVyBrokFWGgqxPVxvzCMbmJUu3xNSoGuiQVYaBLUhEGuiQVYaBLUhEGutSnwuhlXR6bYQx0SSrCQFcnqk2VOSY3WTwc7RjoklSEgS5JRRjoklSEgS5JRRjo6kyFib8CLZRV4fE1aga6JBVhoKsT4ZyfRsiHVzsGuiQVYaBLUhGtAj0itkbEwYiYi4irFtkeEfGeZvuNEXFW96VKkpYzNNAjYgVwDbAN2AJcEhFbBnbbBmxuvnYA7++4TknSECtb7HMOMJeZtwFExB5gO3Bz3z7bgY9k76PqvhIRJ0fEmsz8fucVa2Ld8N17eNW7vjjuMo7JAw89PO4StIR77n9g6h9fj/jNs9dz+ctO6/zntgn0tcChvuV54EUt9lkLPCbQI2IHvWfwbNiw4Uhr1QS79LznsP/AD8ZdRifO2nAK5572jHGXoT7bz1zLPfc9SBZ5p8Cqpz5xJD+3TaAvNjA0+K/aZh8ycxewC2BmZqbGkRHQ+w+3/cy14y5DRZ298VTO3njquMuYeG1eFJ0H1vctrwPuPIp9JEkj1CbQrwc2R8SmiDgJuBjYO7DPXuDSZtrlXOBez59L0vE19JRLZh6OiCuB/cAKYHdmHoiIK5rtO4F9wIXAHHA/cNnoSpYkLabNOXQycx+90O5ft7PvdgJv7rY0SdKR8J2iklSEgS5JRRjoklSEgS5JRUSO6TIgEbEAfPco774KuLvDcibVidInnDi92mct4+jzOZm5erENYwv0YxERs5k5M+46Ru1E6RNOnF7ts5ZJ69NTLpJUhIEuSUVMa6DvGncBx8mJ0iecOL3aZy0T1edUnkOXJD3etD5DlyQNMNAlqYipC/RhF6yeNBGxPiI+HxG3RMSBiHhLs/7UiPjPiPh28/2Uvvtc3fR3MCJe3bf+hRHxzWbbeyIimvVPjIiPNeu/GhEbj3ujj9a4IiL+KyKua5bL9dlcYvETEfGt5rieV7TPP2weszdFxEcj4klV+oyI3RFxV0Tc1LfuuPQWEW9ofse3I+INnTaWmVPzRe/je78DnAacBHwD2DLuuobUvAY4q7n9NOBWehfb/ivgqmb9VcA7mttbmr6eCGxq+l3RbPsacB69K0R9BtjWrP89YGdz+2LgY2Ps94+Afwaua5bL9Ql8GLi8uX0ScHK1PuldQvJ24Oeb5X8B3lilT+BXgLOAm/rWjbw34FTgtub7Kc3tUzrraxz/IY7hIJwH7O9bvhq4etx1HWEPnwZeBRwE1jTr1gAHF+uJ3ufQn9fs862+9ZcAH+jfp7m9kt4712IMva0DPgu8gkcDvVSfwC/QC7oYWF+tz0euE3xqU8N1wAWV+gQ28thAH3lv/fs02z4AXNJVT9N2ymWpi1FPhebPrhcAXwWelc1VnZrvz2x2W6rHtc3twfWPuU9mHgbuBcZxleN3A38CPNy3rlqfpwELwN83p5Y+GBFPoVifmfk94K+BO+hd7P3ezPwPivU54Hj0NtIMm7ZAb3Ux6kkUEU8FPgn8QWb+eLldF1mXy6xf7j7HTUS8BrgrM29oe5dF1k18n/SebZ0FvD8zXwDcR+/P86VMZZ/N+ePt9E4xPBt4SkS8frm7LLJu4vtsqcveRtrztAX6VF6MOiKeQC/M/ykzr21W/zAi1jTb1wB3NeuX6nG+uT24/jH3iYiVwNOBH3XfybJeAvx6RPw3sAd4RUT8I/X6nAfmM/OrzfIn6AV8tT5/Dbg9Mxcy80HgWuDF1Ouz3/HobaQZNm2B3uaC1ROledX774BbMvNdfZv2Ao+8wv0GeufWH1l/cfMq+SZgM/C15k/An0TEuc3PvHTgPo/8rNcCn8vmBN3xkplXZ+a6zNxI77h8LjNfT70+fwAciojnNateCdxMsT7pnWo5NyKe3NT3SuAW6vXZ73j0th+4ICJOaf4KuqBZ143j9QJEhy9kXEhvUuQ7wNvGXU+Lel9K70+qG4GvN18X0juf9lng2833U/vu87amv4M0r5o362eAm5pt7+XRd/o+Cfg4vYt0fw04bcw9n8+jL4qW6xM4E5htjumn6E0rVOzzL4BvNTX+A70pjxJ9Ah+l99rAg/SeNb/pePUG/E6zfg64rMu+fOu/JBUxbadcJElLMNAlqQgDXZKKMNAlqQgDXZKKMNAlqQgDXZKK+H9HtCoqoI/YNQAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mask_df</span> <span class="o">=</span> <span class="n">get_default_mask_df</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="mi">728</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mask_df</span><span class="o">.</span><span class="n">sample_mask</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&lt;matplotlib.lines.Line2D at 0x7fb7fbc96990&gt;]</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-for-datasets-with-more-than-two-time-series">Test for datasets with more than two time series<a class="anchor-link" href="#Test-for-datasets-with-more-than-two-time-series"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nixtlats.data.datasets.tourism</span> <span class="kn">import</span> <span class="n">Tourism</span><span class="p">,</span> <span class="n">TourismInfo</span>

<span class="n">meta</span> <span class="o">=</span> <span class="n">TourismInfo</span><span class="p">[</span><span class="s1">&#39;Yearly&#39;</span><span class="p">]</span>
<span class="n">Y_df</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">Tourism</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">test_default_mask</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">test_default_mask</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Dataset-tests">Dataset tests<a class="anchor-link" href="#Dataset-tests"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">instantiate_datasets</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                         <span class="n">ds_in_test</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">input_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                         <span class="n">output_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">complete_windows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">sample_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">mask_df</span> <span class="o">=</span> <span class="n">get_default_mask_df</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">)</span>
                        
    <span class="n">ts_dataset</span> <span class="o">=</span> <span class="n">TimeSeriesDataset</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="o">=</span><span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="o">=</span><span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> 
                                   <span class="n">mask_df</span><span class="o">=</span><span class="n">mask_df</span><span class="p">,</span>
                                   <span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span>
                                   <span class="n">output_size</span><span class="o">=</span><span class="n">output_size</span><span class="p">,</span>
                                   <span class="n">complete_windows</span><span class="o">=</span><span class="n">complete_windows</span><span class="p">)</span>
    
    <span class="n">wd_dataset</span> <span class="o">=</span> <span class="n">WindowsDataset</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="o">=</span><span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="o">=</span><span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> 
                                   <span class="n">mask_df</span><span class="o">=</span><span class="n">mask_df</span><span class="p">,</span>
                                   <span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span>
                                   <span class="n">output_size</span><span class="o">=</span><span class="n">output_size</span><span class="p">,</span>
                                   <span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">,</span>
                                   <span class="n">complete_windows</span><span class="o">=</span><span class="n">complete_windows</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ts_dataset</span><span class="p">,</span> <span class="n">wd_dataset</span><span class="p">,</span> <span class="n">mask_df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_dataset_attrs</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="p">):</span>
    <span class="c1"># This set catches mistmaches between Y_df and ts_tensor</span>
    <span class="n">ts_dataset</span><span class="p">,</span> <span class="n">wd_dataset</span><span class="p">,</span> <span class="n">mask_df</span> <span class="o">=</span> <span class="n">instantiate_datasets</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="o">=</span><span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="o">=</span><span class="n">X_df</span><span class="p">,</span> 
                                           <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> 
                                           <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">)</span>
    
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">mask_df</span><span class="p">]</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ds&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="p">]</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    
    <span class="c1">#Temporal variables</span>
    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ts_dataset</span><span class="p">,</span> <span class="n">wd_dataset</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">idx_ts</span><span class="p">,</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">)):</span>
            <span class="n">len_ts</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">len_series</span><span class="p">[</span><span class="n">idx_ts</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">t_cols</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="n">idx_tensor</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">t_cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                <span class="n">ts_tensor</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">ts_tensor</span><span class="p">[</span><span class="n">idx_ts</span><span class="p">,</span> <span class="n">idx_tensor</span><span class="p">,</span> <span class="o">-</span><span class="n">len_ts</span><span class="p">:]</span>

                <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ts_tensor</span><span class="p">),</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Error with time series </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s1"> and col </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> (idx=</span><span class="si">{</span><span class="n">idx_ts</span><span class="si">}</span><span class="s1">).&#39;</span>
                <span class="p">)</span>

        <span class="c1">#Static variables</span>
        <span class="k">for</span> <span class="n">idx_ts</span><span class="p">,</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">S_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">)):</span>
            <span class="n">len_ts</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">len_series</span><span class="p">[</span><span class="n">idx_ts</span><span class="p">]</span>

            <span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">dataset</span><span class="o">.</span><span class="n">s_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">s_matrix</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">s_matrix</span><span class="p">[[</span><span class="n">idx_ts</span><span class="p">]]</span>

            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">),</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Error with static variables for time series </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s1"> (idx=</span><span class="si">{</span><span class="n">idx_ts</span><span class="si">}</span><span class="s1">)&#39;</span>
            <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_get_f_idxs</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="p">,</span> <span class="n">expected_f_idxs</span><span class="p">):</span>
    <span class="n">ts_dataset</span><span class="p">,</span> <span class="n">wd_dataset</span><span class="p">,</span> <span class="n">mask_df</span> <span class="o">=</span> <span class="n">instantiate_datasets</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="o">=</span><span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="o">=</span><span class="n">X_df</span><span class="p">,</span> 
                                           <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> 
                                           <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">ts_dataset</span><span class="o">.</span><span class="n">_get_f_idxs</span><span class="p">(</span><span class="n">f_cols</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_f_idxs</span>
    <span class="k">assert</span> <span class="n">wd_dataset</span><span class="o">.</span><span class="n">_get_f_idxs</span><span class="p">(</span><span class="n">f_cols</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_f_idxs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_ts_tensor</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="p">,</span> 
                   <span class="n">input_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">ts_idxs</span><span class="p">):</span>
    <span class="n">ts_dataset</span><span class="p">,</span> <span class="n">wd_dataset</span><span class="p">,</span> <span class="n">mask_df</span> <span class="o">=</span> <span class="n">instantiate_datasets</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="o">=</span><span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="o">=</span><span class="n">X_df</span><span class="p">,</span> 
                                           <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> 
                                           <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span>
                                           <span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span>
                                           <span class="n">output_size</span><span class="o">=</span><span class="n">output_size</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ts_dataset</span><span class="p">,</span> <span class="n">wd_dataset</span><span class="p">]:</span>
        <span class="n">min_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">len_series</span><span class="p">)</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">mask_df</span><span class="p">]</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ds&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="p">]</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        
        <span class="c1"># This process only works for balanced datasets.</span>
        
        <span class="n">n_ts</span> <span class="o">=</span> <span class="n">Y_df</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n_x</span> <span class="o">=</span> <span class="n">dfs</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_ts</span><span class="p">)</span> <span class="k">if</span> <span class="n">ts_idxs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ts_idxs</span>

        <span class="n">e_filtered_tensor</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_ts</span><span class="p">,</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">n_x</span><span class="p">))[</span><span class="n">idxs</span><span class="p">])</span>
        <span class="n">e_filtered_tensor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">e_filtered_tensor</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">filtered_tensor</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">ts_tensor</span><span class="p">[</span><span class="n">ts_idxs</span><span class="p">,</span> <span class="p">:,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">first_ds</span><span class="p">:]</span>

        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">e_filtered_tensor</span><span class="p">,</span> <span class="n">filtered_tensor</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">&quot;Expected and dataset filtered_tensor are different. Check.&quot;</span>
        <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.lib.stride_tricks</span> <span class="kn">import</span> <span class="n">sliding_window_view</span>

<span class="c1"># This test only works for the synthetic dataset constructed </span>
<span class="c1"># using create_synthetic_tsdata</span>
<span class="c1"># and for the 21 time series</span>
<span class="k">def</span> <span class="nf">test_batch_construction_windows</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="p">,</span> 
                                    <span class="n">is_test</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> 
                                    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test to verify that the batch (of windows) is well constructed.&quot;&quot;&quot;</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">mask_df</span> <span class="o">=</span> <span class="n">instantiate_datasets</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="o">=</span><span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="o">=</span><span class="n">X_df</span><span class="p">,</span> 
                                               <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span>
                                               <span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span>
                                               <span class="n">output_size</span><span class="o">=</span><span class="n">output_size</span><span class="p">,</span>
                                               <span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">)</span>
    
    <span class="n">windows_size</span> <span class="o">=</span> <span class="n">input_size</span> <span class="o">+</span> <span class="n">output_size</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="n">Y_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    
    <span class="n">windows</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    
    <span class="c1">#Expected windows</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">Y_df</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">20</span><span class="p">]</span>
    <span class="n">Y_original</span> <span class="o">=</span> <span class="n">Y_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;unique_id == @uid&#39;</span><span class="p">)[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">Y_original</span><span class="o">.</span><span class="n">size</span>
    <span class="n">Y_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_len</span><span class="p">)</span>
    <span class="n">Y_sample</span><span class="p">[</span><span class="o">-</span><span class="n">size</span><span class="p">:]</span> <span class="o">=</span> <span class="n">Y_original</span>
    
    <span class="n">Y_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">Y_sample</span><span class="p">,</span> <span class="p">(</span><span class="n">input_size</span><span class="o">+</span><span class="mi">100</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span>

    <span class="n">e_windows</span> <span class="o">=</span> <span class="n">sliding_window_view</span><span class="p">(</span><span class="n">Y_sample</span><span class="p">,</span> <span class="n">window_shape</span><span class="o">=</span><span class="n">windows_size</span><span class="p">)</span>
    <span class="n">e_windows</span> <span class="o">=</span> <span class="n">e_windows</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="p">(</span><span class="n">ds_in_test</span><span class="o">+</span><span class="n">output_size</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="n">sample_freq</span><span class="p">]</span> <span class="c1">#-1 for at least one available sample</span>

    <span class="c1"># This test works assuming there are no series with all values of zero.</span>
    <span class="n">sampleable_windows_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">e_windows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>     
    <span class="n">e_windows</span> <span class="o">=</span> <span class="n">e_windows</span><span class="p">[</span><span class="n">sampleable_windows_idxs</span><span class="p">]</span>
    
    <span class="c1">#Comparison</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span> <span class="n">e_windows</span><span class="p">),</span> <span class="p">(</span>
        <span class="s1">&#39;Expected and actual windows are different&#39;</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.lib.stride_tricks</span> <span class="kn">import</span> <span class="n">sliding_window_view</span>

<span class="c1"># This test only works for the synthetic dataset constructed </span>
<span class="c1"># using create_synthetic_tsdata</span>
<span class="c1"># and for the 21 time series</span>
<span class="k">def</span> <span class="nf">test_batch_construction_ts</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="p">,</span> 
                                    <span class="n">is_test</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> 
                                    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test to verify that the batch (of windows) is well constructed.&quot;&quot;&quot;</span>

    <span class="n">dataset</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">mask_df</span> <span class="o">=</span> <span class="n">instantiate_datasets</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="o">=</span><span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="o">=</span><span class="n">X_df</span><span class="p">,</span> 
                                               <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span>
                                               <span class="n">input_size</span><span class="o">=</span><span class="n">input_size</span><span class="p">,</span>
                                               <span class="n">output_size</span><span class="o">=</span><span class="n">output_size</span><span class="p">,</span>
                                               <span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">)</span>
    
    <span class="n">batch</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="n">Y_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    
    <span class="c1">#Expected windows</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">Y_df</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">20</span><span class="p">]</span>
    <span class="n">Y_original</span> <span class="o">=</span> <span class="n">Y_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;unique_id == @uid&#39;</span><span class="p">)[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">Y_original</span><span class="o">.</span><span class="n">size</span>
    <span class="n">e_batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_len</span><span class="p">)</span>
    <span class="n">e_batch</span><span class="p">[</span><span class="o">-</span><span class="n">size</span><span class="p">:]</span> <span class="o">=</span> <span class="n">Y_original</span>
    <span class="n">e_batch</span> <span class="o">=</span> <span class="n">e_batch</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

    <span class="c1">#Comparison</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">e_batch</span><span class="p">),</span> <span class="p">(</span>
        <span class="s1">&#39;Expected and actual windows are different&#39;</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-for-not-sorted-datasets-with-more-than-two-time-series">Test for not sorted datasets with more than two time series<a class="anchor-link" href="#Test-for-not-sorted-datasets-with-more-than-two-time-series"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nixtlats.data.utils</span> <span class="kn">import</span> <span class="n">create_synthetic_tsdata</span>

<span class="n">Y_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">S_df</span> <span class="o">=</span> <span class="n">create_synthetic_tsdata</span><span class="p">()</span>
<span class="n">ds_in_test</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">is_test</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">f_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;future_1&#39;</span><span class="p">]</span>
<span class="n">expected_f_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">len_sample_chunks</span> <span class="o">=</span> <span class="mi">15</span> <span class="c1">#only for ESRNN</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_dataset_attrs</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_get_f_idxs</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span> 
                <span class="n">expected_f_idxs</span><span class="o">=</span><span class="n">expected_f_idxs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Expected-error-for-non-sorted-datasets">Expected error for non-sorted datasets<a class="anchor-link" href="#Expected-error-for-non-sorted-datasets"> </a></h4><p>For the <code>ts_tensor</code> attribute from the <code>dataset</code> and <code>Y_df</code> to have the same order it is necessary that <code>Y_df</code> is sorted by <code>unique_id</code> and <code>ds</code>. This test (expected error) proves that for unordered data the order is different.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">_fail_non_sorted</span><span class="p">():</span> 
    <span class="n">test_ts_tensor</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> 
                   <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> 
                   <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span>
                   <span class="n">ts_idxs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                   <span class="n">output_size</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">)</span>
<span class="n">test_fail</span><span class="p">(</span><span class="n">_fail_non_sorted</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test-using-sorted-synthtic-ts-data">Test using sorted synthtic ts data<a class="anchor-link" href="#Test-using-sorted-synthtic-ts-data"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nixtlats.data.utils</span> <span class="kn">import</span> <span class="n">create_synthetic_tsdata</span>

<span class="n">Y_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">S_df</span> <span class="o">=</span> <span class="n">create_synthetic_tsdata</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_in_test</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">is_test</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">f_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;future_1&#39;</span><span class="p">]</span>
<span class="n">expected_f_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">len_sample_chunks</span> <span class="o">=</span> <span class="mi">15</span> <span class="c1">#only for ESRNN</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_batch_construction_windows</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span>
                                <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span> <span class="n">input_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                <span class="n">sample_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_batch_construction_ts</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span>
                           <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span> <span class="n">input_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">sample_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-for-already-sorted-datasets">Test for already sorted datasets<a class="anchor-link" href="#Test-for-already-sorted-datasets"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nixtlats.data.datasets.epf</span> <span class="kn">import</span> <span class="n">EPF</span><span class="p">,</span> <span class="n">EPFInfo</span>

<span class="n">Y_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">S_df</span> <span class="o">=</span> <span class="n">EPF</span><span class="o">.</span><span class="n">load_groups</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="s1">&#39;PJM&#39;</span><span class="p">])</span>
<span class="n">f_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Exogenous1&#39;</span><span class="p">,</span> <span class="s1">&#39;Exogenous2&#39;</span><span class="p">]</span>
<span class="n">ds_in_test</span> <span class="o">=</span> <span class="mi">728</span> <span class="o">*</span> <span class="mi">24</span>
<span class="n">is_test</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">expected_f_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">#after y column</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_dataset_attrs</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_ts_tensor</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span>
               <span class="n">input_size</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">ts_idxs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_get_f_idxs</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="n">f_cols</span><span class="p">,</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span> 
                <span class="n">expected_f_idxs</span><span class="o">=</span><span class="n">expected_f_idxs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-for-already-sorted-datasets-with-more-than-two-time-series">Test for already sorted datasets with more than two time series<a class="anchor-link" href="#Test-for-already-sorted-datasets-with-more-than-two-time-series"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nixtlats.data.datasets.tourism</span> <span class="kn">import</span> <span class="n">Tourism</span><span class="p">,</span> <span class="n">TourismInfo</span>

<span class="n">meta</span> <span class="o">=</span> <span class="n">TourismInfo</span><span class="p">[</span><span class="s1">&#39;Yearly&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">Tourism</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./data&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_week</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;id_ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

<span class="n">Y_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ds&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">X_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ds&#39;</span><span class="p">,</span> <span class="s1">&#39;day_of_week&#39;</span><span class="p">])</span>
<span class="n">S_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;id_ts&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Y_df</span> <span class="o">=</span> <span class="n">Y_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">X_df</span> <span class="o">=</span> <span class="n">X_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_dataset_attrs</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="p">[],</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_ts_tensor</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="p">[],</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">input_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
               <span class="n">output_size</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="n">ts_idxs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_get_f_idxs</span><span class="p">(</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="p">,</span> <span class="n">f_cols</span><span class="o">=</span><span class="p">[],</span> <span class="n">ds_in_test</span><span class="o">=</span><span class="n">ds_in_test</span><span class="p">,</span> <span class="n">is_test</span><span class="o">=</span><span class="n">is_test</span><span class="p">,</span> 
                <span class="n">expected_f_idxs</span><span class="o">=</span><span class="p">[])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

